# ==============================================================================
# ContinuityBridge - CLUSTER DEPLOYMENT (Perfil C)
# Arquitectura Distribuida: App Server + DB Server
# ==============================================================================

# ==============================================================================
# DEPLOYMENT ARCHITECTURE
# ==============================================================================
DEPLOYMENT_PROFILE=cluster

# ==============================================================================
# SERVER TOPOLOGY
# ==============================================================================
# App Server Configuration
APP_SERVER_ID=app-01
APP_SERVER_HOST=10.0.1.10           # IP del servidor de aplicación
APP_PORT=5000

# DB Server Configuration
DB_SERVER_HOST=10.0.1.20            # IP del servidor de base de datos
DB_SERVER_PORT=5432
VALKEY_SERVER_PORT=6379

# ==============================================================================
# DATABASE CONNECTION (REMOTE)
# ==============================================================================
DB_TYPE=postgres
POSTGRES_DB=continuitybridge_main
POSTGRES_USER=cbadmin
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE

# SSL/TLS para conexión entre servidores
DB_SSL_ENABLED=true
DB_SSL_REJECT_UNAUTHORIZED=false    # true para producción con certificados válidos

# Performance Tuning
POSTGRES_SHARED_BUFFERS=512MB
POSTGRES_EFFECTIVE_CACHE_SIZE=2GB
POSTGRES_MAX_CONNECTIONS=200

# Data Persistence Paths (DB Server)
POSTGRES_DATA_PATH=/var/lib/continuitybridge/postgres
VALKEY_DATA_PATH=/var/lib/continuitybridge/valkey

# ==============================================================================
# VALKEY/REDIS CONNECTION (REMOTE)
# ==============================================================================
VALKEY_ENABLED=true
VALKEY_PASSWORD=CHANGE_ME_VALKEY_PASSWORD
VALKEY_MAX_MEMORY=2gb

# ==============================================================================
# APPLICATION SETTINGS
# ==============================================================================
NODE_ENV=production
APP_DOMAIN=yourdomain.com
APP_URL=https://yourdomain.com

# Security
ENCRYPTION_KEY=CHANGE_ME_32_CHAR_ENCRYPTION_KEY_HERE
SUPERADMIN_API_KEY=cb_prod_CHANGE_ME_SUPERADMIN_KEY

# Email Service
RESEND_API_KEY=re_YOUR_RESEND_API_KEY

# Deployment Type
VITE_DEPLOYMENT_TYPE=customer
AUTH_GUARD_ENABLED=true

# ==============================================================================
# BACKUP CONFIGURATION
# ==============================================================================
BACKUP_RETENTION_DAYS=30

# ==============================================================================
# NETWORK SECURITY
# ==============================================================================
# Firewall Rules (Configure on infrastructure):
# - App Server → DB Server: Allow 5432 (PostgreSQL)
# - App Server → DB Server: Allow 6379 (Valkey)
# - Internet → App Server: Allow 80, 443 (HTTP/HTTPS)
# - DB Server: Block all incoming except from App Server

# ==============================================================================
# MONITORING & OBSERVABILITY
# ==============================================================================
# Prometheus endpoints
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# Grafana dashboards
GRAFANA_ENABLED=true
GRAFANA_PORT=3000

# ==============================================================================
# SCALING CONFIGURATION
# ==============================================================================
# Horizontal Scaling (App Server)
# To scale: docker-compose -f docker-compose.cluster.yml up -d --scale app=3
APP_REPLICAS=2

# Load Balancer Configuration (if using nginx/haproxy)
LOAD_BALANCER_ENABLED=false
LOAD_BALANCER_PORT=80

# ==============================================================================
# NOTES FOR CLUSTER DEPLOYMENT
# ==============================================================================
# 
# APP SERVER DEPLOYMENT:
#   1. Install Docker on App Server
#   2. Copy this .env file to App Server
#   3. Run: docker-compose -f docker-compose.cluster.yml up -d app
#   4. App server is stateless - can be scaled horizontally
#
# DB SERVER DEPLOYMENT:
#   1. Install Docker on DB Server
#   2. Copy this .env file to DB Server
#   3. Create data directories:
#        mkdir -p /var/lib/continuitybridge/postgres
#        mkdir -p /var/lib/continuitybridge/valkey
#   4. Run: docker-compose -f docker-compose.cluster.yml up -d postgres valkey
#   5. DB server is stateful - DO NOT SCALE
#
# NETWORK REQUIREMENTS:
#   - Private network between App and DB servers (VPC/VLAN)
#   - Firewall rules to restrict DB access
#   - SSL/TLS certificates for secure communication
#
# BACKUP STRATEGY:
#   - Automated backups run on DB Server
#   - Backup to external storage (S3, NFS, etc.)
#   - Test restore procedures regularly
#
# MONITORING:
#   - Deploy Prometheus on DB Server
#   - Deploy Grafana on App Server or separate monitoring server
#   - Configure alerts for disk space, CPU, memory
# ==============================================================================
